stage:
  only:
    - master
  script:
    - docker login -u webrtc -p $PASSWORD hub.ruzik.xyz
    - echo "Building hub.ruzik.xyz/webrtc/isconsultant:$CI_COMMIT_SHORT_SHA"
    - docker build -f Dockerfile.server -t isconsultant:$CI_COMMIT_SHORT_SHA .
    - echo "Building hub.ruzik.xyz/webrtc/isconsultant-client:$CI_COMMIT_SHORT_SHA"
    - docker build -f Dockerfile.client -t isconsultant-client:$CI_COMMIT_SHORT_SHA .
    - docker tag isconsultant:$CI_COMMIT_SHORT_SHA hub.ruzik.xyz/webrtc/isconsultant:$CI_COMMIT_SHORT_SHA
    - docker tag isconsultant-client:$CI_COMMIT_SHORT_SHA hub.ruzik.xyz/webrtc/isconsultant-client:$CI_COMMIT_SHORT_SHA
    - docker push hub.ruzik.xyz/webrtc/isconsultant:$CI_COMMIT_SHORT_SHA
    - docker push hub.ruzik.xyz/webrtc/isconsultant-client:$CI_COMMIT_SHORT_SHA
    - docker tag hub.ruzik.xyz/webrtc/isconsultant:$CI_COMMIT_SHORT_SHA hub.ruzik.xyz/webrtc/isconsultant:latest
    - docker tag hub.ruzik.xyz/webrtc/isconsultant-client:$CI_COMMIT_SHORT_SHA hub.ruzik.xyz/webrtc/isconsultant-client:latest 
    - docker push hub.ruzik.xyz/webrtc/isconsultant:latest
    - docker push hub.ruzik.xyz/webrtc/isconsultant-client:latest

