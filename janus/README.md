# Введение
Для корректного функционирования видео сервера и установки соединений между браузером клиента и сервером требуется наличие в системе STUN сервера. Он нужен для получения внешнего IP адреса и порта, по которому сервер будет обращаться к клиенту в том случае, если клиент находится за NAT.
# STUN сервер
## Установка на Ubuntu
В данном проекте используется реализация TURN/STUN сервера с открытым исходным кодом - coturn.
```
sudo apt-get install coturn
```
Для того, чтобы сервер автоматически запускался, выполнить следующую команду:
```
sudo systemctl enable coturn --now
```
## Настройка
В конфигурации сервера следует прописать, что нам нужен только STUN сервер:
```
stun-only
```
Также, если сервер находится за NAT, следует указать внешний IP-адрес, по которому виден сервер в сети интернет:
```
external-ip=1.2.3.4
```
# Janus
## Docker
Docker устанавливается на Ubuntu очень просто - достаточно воспользоваться менеджером пакетов:
```
sudo apt-get install docker
```
Для janus-gateway есть официальный образ Docker. Janus использует определенные порты для коммуникации с клиентом - их необходимо прописать в `docker-compose.yml` для удобства. Здесь же подключим файл конфигурации `janus.jcfg` извне:
```
version: '2.1'
services:
   janus-gateway:
    image: 'canyan/janus-gateway:0.10.7'
    command: ["/usr/local/bin/janus", "-F", "/usr/local/etc/janus"]
    ports:
      - "8188:8188"
    volumes:
      - "./janus.jcfg:/usr/local/etc/janus/janus.jcfg"    
    restart: always
```
После чего:
```
sudo docker-compose up 
```
# Настройка

## Используемые порты
Ниже предоставлен список используемых портов, которые исползуют Janus и Coturn:

|Номер порта  | UDP/TCP | Назначение
|------------- | ------------- | --|
|3478  | UDP | STUN сервер|
|8188  | TCP | Janus signaling (Websocket)|
|20000-40000 | UDP | Janus Webrtc|
Если Janus и/или Coturn находятся за firewall/NAT, необходимо настроить переадресацию данных портов для корректной работы.
